# Sharding & Replication

데이터가 커지고 트래픽이 많아지면 하나의 DB로는 한계가 온다. 이 문서는 샤딩과 리플리케이션의 개념과 설계 방법을 설명한다.

---

## 1. Replication (복제)
- **Master-Slave**: 쓰기는 마스터, 읽기는 슬레이브. 읽기 부하 분산.
- **Master-Master**: 여러 노드가 쓰기를 처리. 충돌 해결 로직 필요.
- **Sync vs Async**: 동기 복제는 일관성↑, 지연↑ / 비동기 복제는 반대.
- **사용 사례**: 읽기 비중이 높거나 장애 시 Failover를 빠르게 해야 할 때.

## 2. Sharding (파티셔닝)
- 데이터를 여러 DB에 나누어 저장.
- **Range Sharding**: 값을 범위로 나눔 (예: 날짜, 사용자 ID 구간).
- **Hash Sharding**: 균등 분배. 확장이 쉬우나 범위 조회 어려움.
- **Directory/Lookup**: 메타데이터 테이블에서 샤드 위치를 찾음.

---

## 3. 설계 시 고려할 점
- 샤드 키 선택: 쿼리 패턴, 데이터 분포, 핫스팟 여부.
- 재샤딩 전략: 노드 추가 시 데이터를 어떻게 이동할지.
- 글로벌 트랜잭션: 2PC/SAGA/보상 트랜잭션 필요 여부.
- 모니터링: 각 샤드별 QPS, 지연, 용량, 복구 시간.

---

## 4. 체크리스트
- [ ] 읽기/쓰기 부하, 데이터 크기, 성장률을 수치로 분석했는가?
- [ ] 샤드 키가 균등하게 분포하고 있는가? (히트맵/히스토그램 확인)
- [ ] 복제 지연 모니터링과 자동 Failover 절차를 갖고 있는가?
- [ ] 샤드 간 조인/집계가 필요한 경우를 어떻게 처리할지 정의했는가?

---

## 5. 실습 아이디어
- **실습 1**: MySQL/PosgreSQL에서 읽기 복제본을 추가하고, 읽기 트래픽을 분산시켜 본다.
- **실습 2**: Hash Sharding으로 데이터를 분배하고, 특정 샤드에 트래픽을 몰아 핫스팟을 관찰.
- **실습 3**: 샤드 추가/삭제 시 데이터를 재배치하는 스크립트를 작성.

