# CDN 개념과 캐시 무효화 전략

CDN(Content Delivery Network)은 전 세계 에지 서버에 정적 자산을 배포해 지연을 최소화한다. 단순히 “붙이면 빠르다”가 아니라, 캐시 정책과 무효화 전략까지 이해해야 효과를 극대화할 수 있다.

---

## 1. CDN 동작 방식
1. 사용자가 정적 리소스(URL)를 요청.
2. CDN 에지 서버가 캐시를 확인 → 있으면 즉시 응답.
3. 없으면 원본 서버(origin)에서 가져와 캐시에 저장.
4. TTL이 만료되거나 무효화 요청이 오면 캐시를 갱신/삭제.

대표 서비스: Cloudflare, Akamai, AWS CloudFront, Fastly 등.

---

## 2. 캐시 정책 설계
- **Cache-Control 헤더**: `max-age`, `s-maxage`, `public/private`, `no-cache`.
- **ETag/Last-Modified**: 조건부 요청을 통해 변경 여부 확인.
- **오리진 Shielding**: 특정 리전에 중간 캐시 계층을 두어 원본 부하를 더 줄임.

---

## 3. 캐시 무효화 전략
| 방법 | 설명 | 장단점 |
| --- | --- | --- |
| TTL 기반 | 시간이 흐르면 자동 만료 | 구현 쉬움, 하지만 변경 즉시 반영 어려움 |
| API/CLI 무효화 | 변경된 경로만 명시적으로 삭제 | 실시간 반영 가능하지만 비용/쿼터 확인 |
| 버전 포함 | 파일 이름이나 쿼리에 버전을 포함 (예: app.v2.js) | 구버전 캐시는 남지만 신규 버전 즉시 제공 |
| Stale-while-revalidate | 만료 후에도 오래된 콘텐츠 제공, 백그라운드 업데이트 | 사용자 경험 우수, 지원 여부 확인 필요 |

---

## 4. 체크리스트
- [ ] 어떤 자산을 CDN에 둘지(정적 파일, 이미지, API 응답 등) 정의했는가?
- [ ] TTL과 무효화 전략을 사용자 요구사항에 맞춰 설정했는가?
- [ ] HTTPS/TLS, WAF, Rate Limit 등 CDN의 보안 기능을 활용하고 있는가?
- [ ] Origin 서버 장애 시 캐시된 콘텐츠를 얼마나 오래 제공할지 정책이 있는가?

---

## 5. 실습 아이디어
- **실습 1**: CloudFront/Cloudflare를 설정해 정적 사이트를 배포하고, 지역별 지연 시간을 측정한다.
- **실습 2**: 파일 버저닝과 무효화 API를 사용해 “배포 후 즉시 적용” 시나리오를 연습한다.
- **실습 3**: `stale-while-revalidate` 헤더를 적용해 만료 후에도 사용자에게 끊김 없는 경험을 제공해 본다.

