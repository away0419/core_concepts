# Sync vs Async 처리 모델

“동기냐 비동기냐”는 단순한 선택 같지만, 응답 속도·확장성·사용자 경험에 직접적인 영향을 준다. 이 문서는 처음 배우는 개발자도 맥락을 파악할 수 있도록 개념 → 활용 → 설계 순으로 설명한다.

---

## 1. 기본 개념부터 잡기

| 구분      | 동기(Synchronous)                                | 비동기(Asynchronous)                          |
| --------- | ------------------------------------------------ | --------------------------------------------- |
| 호출 방식 | 요청을 보낸 스레드가 결과를 받을 때까지 기다림   | 즉시 반환 후 콜백/이벤트/Promise로 결과 통보  |
| 장점      | 코드 읽기 쉽고 디버깅 편함, 트랜잭션 경계가 명확 | 자원 활용도 높고, 대기 시간 숨김, 고병렬 처리 |
| 단점      | I/O 대기 동안 스레드 낭비, 병목 발생             | 흐름 추적과 상태 관리가 복잡, 테스트 어려움   |
| 대표 예   | 결제 승인, 회원가입, 재고 차감                   | 알림 발송, 외부 API 호출, 배치/스트리밍 작업  |

핵심은 **“요청을 보낸 주체가 끝날 때까지 기다리는가?”** 이다.

---

## 2. 왜/언제 어떤 방식을 써야 할까?

1. **동기(Sync)가 적합한 경우**

   - 사용자가 즉시 결과를 확인해야 함 (결제, 로그인).
   - 여러 시스템을 묶는 ACID 트랜잭션이 필요한 경우.
   - 실패 시 즉각적인 오류 전달이 사용자 경험상 중요할 때.

2. **비동기(Async)가 적합한 경우**

   - 오래 걸리는 작업(대용량 처리, 외부 API, 알림 등)으로 응답이 지연될 때.
   - 실패해도 재시도로 복구 가능하고, 사용자를 기다리게 하고 싶지 않을 때.
   - 이벤트 기반 아키텍처로 서비스 간 결합도를 낮추고 싶을 때.

3. **혼합 구조**
   - “주문 요청”은 동기로 처리하고, “재고 차감/배송 준비/알림 발송”은 비동기로 분리.
   - 즉, 중요 경로는 동기로 안정성을 확보하고, 부가 작업은 비동기로 효율을 얻는다.

---

## 3. 흐름을 그림으로 이해하기

```
[사용자 요청]
    │ (동기)
    ▼
[주문 서비스]
    ├─ DB 트랜잭션
    └─ 결제 승인
    │
    ▼
[응답 완료]  ← 사용자에게 주문 번호 반환
    │
    └─ (비동기 이벤트 발행)
        ├─ 재고 차감 워커
        ├─ 배송 준비 워커
        └─ 알림 발송 워커
```

위 순서를 따라가면, 어디까지 기다리고 어디서부터 비동기로 전환되는지 한눈에 파악할 수 있다.

---

## 4. 구현 시 챙겨야 할 포인트

1. **타임아웃/재시도 설정**
   - 동기 호출에 타임아웃·재시도·서킷브레이커가 없으면 장애가 전체로 퍼진다.
2. **Idempotency(멱등성)**
   - 비동기는 메시지 중복이 흔하므로 Idempotency Key를 준비해야 안전하다.
3. **Backpressure & 모니터링**
   - 큐 길이, 처리율, 지연 시간을 수집하고 임계치 이상이면 버퍼/드롭/스케일링 정책을 적용한다.
4. **컨텍스트 전파**
   - Trace ID, 사용자 ID, Security Context 등을 비동기 작업에도 전달해야 추적이 가능하다.
5. **사용자 피드백**
   - 비동기 작업의 진행 상태를 UI에서 폴링/푸시로 알려주면 경험이 좋아진다.

---

## 5. 실습 아이디어

- **실습 1**: 기존 동기 API 중 응답이 느린 기능을 찾아 이벤트 발행 + 워커 구조로 분리해본다.
- **실습 2**: 메시지 큐(DLQ)와 재시도(Backoff) 정책을 직접 설정하고 실패 상황을 시뮬레이션한다.
- **실습 3**: Prometheus/APM으로 동기 요청의 P95/P99, 비동기 큐의 처리율·지연을 시각화한다.

---

## 6. 체크리스트

- [ ] 기능별 지연 허용 범위(SLO)를 정의했는가?
- [ ] 동기 호출에 대한 타임아웃, 재시도, Circuit Breaker 설정을 명시했는가?
- [ ] 비동기 처리 시 실패/재처리 전략(Dead-letter Queue, 재시도 백오프)을 문서화했는가?
- [ ] 메시지 순서·중복 처리 정책과 Idempotency Key를 정의했는가?
- [ ] 동기/비동기 혼합 시 트랜잭션 경계를 명확히 했는가?
