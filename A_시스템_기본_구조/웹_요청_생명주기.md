# 웹 요청의 생명주기

“사용자가 버튼을 클릭하면 서버에서는 어떤 일이 벌어질까?” 이 문서는 DNS부터 응답 렌더링까지 전체 여정을 따라가며 이해할 수 있도록 구성했다.

---

## 1. 전체 흐름 한 눈에 보기

```
사용자 브라우저/앱
    │
    ▼
DNS 조회 → TLS Handshake → 로드 밸런서/CDN → API Gateway/BFF
    │                                             │
    └─────────────────────────────────────────────┼─→ 애플리케이션 서버
                                                  │      ├─ DB/캐시
                                                  │      └─ 외부 API/메시지 큐
                                                  ▼
                                              응답 생성 → 사용자 렌더링
```

이 다이어그램을 머릿속에 넣어두면 이후 단계별 설명이 훨씬 잘 이해된다.

---

## 2. 단계별 상세 설명

1. **DNS 조회**
   - 브라우저/OS/ISP 캐시 → 권한 DNS 서버 순으로 IP를 찾는다.
   - TTL 관리, Secondary DNS 구성으로 장애에 대비한다.
2. **TLS Handshake**
   - HTTPS 연결을 위해 인증서 확인, 대칭키 협상.
   - HSTS, OCSP Stapling으로 보안을 강화한다.
3. **로드 밸런서 & CDN**
   - L4/L7 LB가 요청을 건강한 서버로 분배.
   - CDN은 정적 자산을 가까운 위치에서 제공해 지연을 줄인다.
4. **API Gateway / BFF**
   - 인증/인가, Rate Limit, 요청/응답 변환, A/B 테스트를 담당.
   - 내부 서비스나 마이크로서비스로 라우팅.
5. **애플리케이션 서버**
   - 컨트롤러 → 서비스 → 리포지토리 순으로 도메인 로직 실행.
   - 캐시 조회, 입력 검증, 트랜잭션 처리.
6. **데이터 저장소/외부 API**
   - RDB/NoSQL, 캐시, 메시지 큐, 서드파티 API 호출.
   - 비동기 작업이 필요하면 이벤트/메시지를 발행.
7. **응답 생성 & 렌더링**
   - 결과를 JSON/ProtoBuf 등으로 직렬화하고 압축, 캐시 헤더 설정 후 반환.
   - 브라우저/앱이 데이터를 표현하고 필요 시 추가 요청을 발행.

---

## 3. 왜 이 흐름을 알아야 할까?

- **Latency Budget**: 각 단계의 목표 지연시간을 정하면 어디를 최적화해야 할지 명확해진다.
- **장애 분석**: DNS, TLS, Gateway, 앱 서버, DB 중 어느 구간에서 문제가 생겼는지 빠르게 파악할 수 있다.
- **보안 설계**: TLS, 인증, 입력 검증, WAF, Rate Limit 위치를 체계적으로 배치할 수 있다.
- **관찰성**: Trace ID를 전체 경로에 심어두면 Root Cause 분석이 쉬워진다.

---

## 4. 학습/실습 아이디어

- **실습 1**: 브라우저 개발자 도구(Network 탭)에서 요청 타이밍(DNS, TLS, Request, Response)을 직접 확인한다.
- **실습 2**: 간단한 API를 배포하고 Cloudflare/Akamai 등 CDN을 붙여 응답 속도 변화를 측정한다.
- **실습 3**: 분산 추적(Zipkin, Jaeger, X-Ray)으로 각 구간의 Trace를 시각화한다.

---

## 5. 체크리스트

- [ ] 단계별 지연 시간 지표를 정의하고 분산 추적으로 시각화하는가?
- [ ] TLS 재협상, Keep-Alive, Connection Pool 정책을 문서화했는가?
- [ ] 장애 지점별 우회/재시도 전략(DNS Failover, Circuit Breaker, Cache Fallback)을 갖추었는가?
- [ ] CDN/브라우저/서버 캐시 만료 전략과 무효화 절차를 구분했는가?
- [ ] Trace ID/Request ID가 전 구간에서 유지되어 Root Cause 분석이 가능한가?
- [ ] Zero-downtime 배포 시 Health Check, Connection Drain, Graceful Shutdown 절차를 운영하는가?
