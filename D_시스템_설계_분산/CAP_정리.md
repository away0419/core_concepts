# CAP 정리

CAP 정리는 분산 시스템이 동시에 만족시킬 수 없는 세 가지 속성을 설명한다: Consistency, Availability, Partition Tolerance. 이 문서는 CAP의 의미와 실제 설계 시 해석 방법을 설명한다.

---

## 1. 정의
- **Consistency (일관성)**: 모든 노드가 같은 데이터를 즉시 반환.
- **Availability (가용성)**: 모든 요청에 대해 항상 응답을 반환(성공/실패 여부와 무관).
- **Partition Tolerance (분할 허용)**: 네트워크 분할이 발생해도 시스템이 계속 동작.

네트워크 분할은 현실적으로 피할 수 없으므로, 분산 시스템은 결국 **CP** 또는 **AP** 중 하나를 선택하게 된다.

---

## 2. CP vs AP 예시
- **CP 시스템**: ZooKeeper, etcd, HBase. 분할 발생 시 일관성을 유지하기 위해 일부 요청을 거절.
- **AP 시스템**: Cassandra, DynamoDB, Couchbase. 일관성을 희생하고 요청을 계속 처리 후 나중에 동기화.

---

## 3. 설계 해석
- CAP은 절대 법칙이 아니라 “분할 상황에서 어떤 선택을 할 것인가”에 대한 사고 도구다.
- 실제로는 **PACELC**처럼 지연(Latency)과 일관성 간 트레이드오프까지 고려해야 한다.

---

## 4. 체크리스트
- [ ] 서비스에 허용되는 일관성/가용성 수준을 정의했는가?
- [ ] 네트워크 분할 시 어떤 동작을 할지 명시했는가?
- [ ] Eventually Consistent 데이터를 사용자에게 어떻게 설명할지 UX 전략을 갖고 있는가?
- [ ] CAP 결정에 따라 데이터 모델/캐시/메시지 브로커 구성을 조정했는가?

---

## 5. 실습 아이디어
- **실습 1**: 두 데이터센터 간 네트워크를 의도적으로 끊고(Chaos) 시스템 반응을 관찰.
- **실습 2**: Cassandra의 Consistency Level(ONE, QUORUM, ALL)을 바꿔 가용성/일관성 차이를 테스트.
- **실습 3**: ZooKeeper/etcd로 구성된 CP 시스템에서 리더 노드를 강제로 종료하고 클라이언트 동작을 확인.

