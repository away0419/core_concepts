# 회복탄력성 패턴 (Circuit Breaker / Retry / Timeout / Bulkhead)

분산 시스템에서는 네트워크 실패가 일상이므로, 회복탄력성 패턴으로 장애 전파를 막아야 한다.

---

## 1. Timeout
- 모든 외부 호출에는 타임아웃이 있어야 한다. 기본값을 사용하지 말고 요구사항에 맞춰 설정.
- 타임아웃이 없으면 쓰레드가 무한 대기하며 자원 고갈 → 장애 확산.

## 2. Retry with Backoff
- 일시적 오류는 재시도로 해결 가능. 하지만 무한 재시도 금지.
- 지수 백오프 + Jitter(랜덤 지연)을 적용해 동시 재시도를 방지.
- 재시도 가능한 오류(429, 503 등)와 재시도 불가 오류(4xx)를 구분.

## 3. Circuit Breaker
- 실패율이 일정 임계치를 넘으면 회로를 열어 빠르게 실패를 반환.
- 일정 시간 후 Half-open 상태에서 일부 요청만 시도.
- Hystrix, Resilience4j, Envoy, Istio 등에서 제공.

## 4. Bulkhead
- 자원을 격리해 특정 기능 장애가 전체에 영향을 주지 않도록 한다.
- 스레드 풀, 커넥션 풀, 큐를 서비스별로 분리.

---

## 5. 체크리스트
- [ ] 외부 호출마다 타임아웃과 재시도 정책이 정의되어 있는가?
- [ ] Circuit Breaker 임계치와 관찰 지표를 설정했는가?
- [ ] 스레드/커넥션 풀을 서비스별로 분리해 Bulkhead를 구축했는가?
- [ ] 재시도 시 멱등성 보장을 위한 키/설계를 갖고 있는가?

---

## 6. 실습 아이디어
- **실습 1**: Resilience4j로 타임아웃/재시도/서킷 브레이커를 적용해 보고 대시보드에서 지표를 확인.
- **실습 2**: 서비스 간 호출에 인위적 지연/오류를 주입해 Bulkhead의 효과를 측정.
- **실습 3**: Istio/Envoy의 Fault Injection 기능으로 실패를 시뮬레이션.

